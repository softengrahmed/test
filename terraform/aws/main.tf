provider \"aws\" {\n  region = var.region\n}\n\nresource \"aws_vpc\" \"main\" {\n  cidr_block = var.vpc_cidr\n  tags = {\n    Name = var.vpc_name\n  }\n}\n\nresource \"aws_subnet\" \"public\" {\n  count = length(var.public_subnets)\n  vpc_id = aws_vpc.main.id\n  cidr_block = element(var.public_subnets, count.index)\n  availability_zone = element(var.azs, count.index)\n  map_public_ip_on_launch = true\n  tags = {\n    Name = \"${var.vpc_name}-public-${count.index}\"\n  }\n}\n\nresource \"aws_subnet\" \"private\" {\n  count = length(var.private_subnets)\n  vpc_id = aws_vpc.main.id\n  cidr_block = element(var.private_subnets, count.index)\n  availability_zone = element(var.azs, count.index)\n  tags = {\n    Name = \"${var.vpc_name}-private-${count.index}\"\n  }\n}\n\nresource \"aws_internet_gateway\" \"main\" {\n  vpc_id = aws_vpc.main.id\n  tags = {\n    Name = \"${var.vpc_name}-igw\"\n  }\n}\n\nresource \"aws_nat_gateway\" \"main\" {\n  allocation_id = aws_eip.main.id\n  subnet_id = element(aws_subnet.public.*.id, 0)\n  tags = {\n    Name = \"${var.vpc_name}-nat\"\n  }\n}\n\nresource \"aws_eip\" \"main\" {\n  vpc = true\n}\n\nresource \"aws_route_table\" \"public\" {\n  vpc_id = aws_vpc.main.id\n  route {\n    cidr_block = \"0.0.0.0/0\"\n    gateway_id = aws_internet_gateway.main.id\n  }\n  tags = {\n    Name = \"${var.vpc_name}-public-rt\"\n  }\n}\n\nresource \"aws_route_table_association\" \"public\" {\n  count = length(aws_subnet.public)\n  subnet_id = element(aws_subnet.public.*.id, count.index)\n  route_table_id = aws_route_table.public.id\n}\n\nresource \"aws_route_table\" \"private\" {\n  vpc_id = aws_vpc.main.id\n  route {\n    cidr_block = \"0.0.0.0/0\"\n    nat_gateway_id = aws_nat_gateway.main.id\n  }\n  tags = {\n    Name = \"${var.vpc_name}-private-rt\"\n  }\n}\n\nresource \"aws_route_table_association\" \"private\" {\n  count = length(aws_subnet.private)\n  subnet_id = element(aws_subnet.private.*.id, count.index)\n  route_table_id = aws_route_table.private.id\n}\n\nresource \"aws_ecs_cluster\" \"main\" {\n  name = var.ecs_cluster_name\n}\n\nresource \"aws_ecs_service\" \"main\" {\n  name = var.ecs_service_name\n  cluster = aws_ecs_cluster.main.id\n  task_definition = var.task_definition\n  desired_count = var.desired_count\n  launch_type = \"FARGATE\"\n  network_configuration {\n    subnets = aws_subnet.private.*.id\n    security_groups = [aws_security_group.ecs.id]\n  }\n}\n\nresource \"aws_security_group\" \"ecs\" {\n  vpc_id = aws_vpc.main.id\n  ingress {\n    from_port = 80\n    to_port = 80\n    protocol = \"tcp\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n  egress {\n    from_port = 0\n    to_port = 0\n    protocol = \"-1\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n  tags = {\n    Name = \"${var.vpc_name}-ecs-sg\"\n  }\n}\n\nresource \"aws_db_instance\" \"main\" {\n  identifier = var.rds_identifier\n  engine = var.rds_engine\n  instance_class = var.rds_instance_class\n  allocated_storage = var.rds_allocated_storage\n  name = var.rds_db_name\n  username = var.rds_username\n  password = var.rds