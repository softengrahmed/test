resource \"google_compute_network\" \"vpc_network\" {\n  name                    = \"vpc-network\"\n  auto_create_subnetworks = false\n}\n\nresource \"google_compute_subnetwork\" \"subnet\" {\n  count       = 3\n  name        = \"subnet-${count.index}\"\n  ip_cidr_range = var.subnet_cidr_ranges[count.index]\n  network     = google_compute_network.vpc_network.name\n  region      = var.region\n}\n\nresource \"google_compute_firewall\" \"default\" {\n  name    = \"default-firewall\"\n  network = google_compute_network.vpc_network.name\n\n  allow {\n    protocol = \"tcp\"\n    ports    = [\"22\", \"80\", \"443\"]\n  }\n\n  source_ranges = [\"0.0.0.0/0\"]\n}\n\nresource \"google_compute_router\" \"router\" {\n  name    = \"cloud-router\"\n  network = google_compute_network.vpc_network.name\n  region  = var.region\n}\n\nresource \"google_compute_vpn_gateway\" \"vpn_gateway\" {\n  name    = \"vpn-gateway\"\n  network = google_compute_network.vpc_network.name\n  region  = var.region\n}\n\nresource \"google_compute_interconnect_attachment\" \"interconnect\" {\n  name    = \"interconnect\"\n  router  = google_compute_router.router.name\n  region  = var.region\n}\n\nresource \"google_compute_global_address\" \"default\" {\n  name = \"global-address\"\n}\n\nresource \"google_compute_backend_service\" \"default\" {\n  name        = \"backend-service\"\n  protocol    = \"HTTP\"\n  port_name   = \"http\"\n  timeout_sec = 10\n  health_checks = [google_compute_health_check.default.self_link]\n}\n\nresource \"google_compute_url_map\" \"default\" {\n  name            = \"url-map\"\n  default_service = google_compute_backend_service.default.self_link\n}\n\nresource \"google_compute_target_http_proxy\" \"default\" {\n  name   = \"http-proxy\"\n  url_map = google_compute_url_map.default.self_link\n}\n\nresource \"google_compute_global_forwarding_rule\" \"default\" {\n  name        = \"forwarding-rule\"\n  target      = google_compute_target_http_proxy.default.self_link\n  port_range  = \"80\"\n  ip_address  = google_compute_global_address.default.address\n}\n\nresource \"google_compute_instance_template\" \"template\" {\n  name        = \"instance-template\"\n  machine_type = \"n1-standard-1\"\n  region      = var.region\n\n  disk {\n    source_image = \"debian-cloud/debian-9\"\n  }\n\n  network_interface {\n    network = google_compute_network.vpc_network.name\n    subnetwork = google_compute_subnetwork.subnet[0].name\n  }\n}\n\nresource \"google_compute_instance_group_manager\" \"group_manager\" {\n  name               = \"instance-group-manager\"\n  base_instance_name = \"instance\"\n  region             = var.region\n  instance_template  = google_compute_instance_template.template.self_link\n  target_size        = 2\n}\n\nresource \"google_storage_bucket\" \"bucket\" {\n  name     = \"cloud-storage-bucket\"\n  location = var.region\n}\n\nresource \"google_sql_database_instance\" \"default\" {\n  name             = \"sql-instance\"\n  database_version = \"MYSQL_5_7\"\n  region           = var.region\n\n  settings {\n    tier = \"db-f1-micro\"\n  }\n}\n\nresource \"google_dns_managed_zone\" \"zone\" {\n  name     = \"dns-zone\"\n  dns_name = \"example.com.\"\n}\n\nresource \"google_pubsub_topic\" \"topic\" {\n  name = \"pubsub-topic\"\n}\n\nresource \"google_pubsub_subscription\" \"subscription\" {\n  name  = \"pubsub-subscription\"\n  topic = google_pubsub_topic.topic.name\n}\n\nresource \"google_cloudfunctions_function\" \"function\" {\n  name        = \"cloud-function\"\n  runtime     = \"nodejs10\"\n  entry_point = \"helloWorld\"\n  source_archive_bucket = google_storage_bucket.bucket.name\n  source_archive_object = \"function-source.zip\"\n  trigger_http = true\n}\n\nresource \"google_cloud_run_service\" \"service\" {\n  name     = \"cloud-run-service\"\